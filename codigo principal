#include <iostream>
using namespace std;

struct Proceso {
    int id;
    char nombre[30];
    int prioridad;
    char estado[15];
    Proceso* siguiente;
};

//ESTRUCTURA PARA LA COLA 
struct ProcesoCola {
    int id;
    char nombre[30];
    int prioridad;
    int tamanoMemoria;
    char estado[15];
    ProcesoCola* siguiente;
};

Proceso* inicio = NULL;
ProcesoCola* inicioCola = NULL; // OTRO PUNTERO ESPECIL PARA EL USO DE COLAS


// Estructura para el bloque de memoria en la pila
struct BloqueMemoria {
    int idProceso;
    int tamano;
    BloqueMemoria* siguiente;
};

// Puntero al tope de la pila
BloqueMemoria* topeMemoria = NULL;

// Asignar memoria (push)
void asignarMemoria() {
    int id, tamano;
    cout << "ID del proceso que solicita memoria: ";
    cin >> id;
    cout << "Tama√±o de memoria a asignar (MB): ";
    cin >> tamano;

    BloqueMemoria* nuevo = new BloqueMemoria();
    nuevo->idProceso = id;
    nuevo->tamano = tamano;
    nuevo->siguiente = topeMemoria;
    topeMemoria = nuevo;

    cout << "Memoria asignada correctamente.\n";
}

// Liberar memoria (pop)
void liberarMemoria() {
    if (topeMemoria == NULL) {
        cout << "No hay memoria para liberar.\n";
        return;
    }

    BloqueMemoria* temp = topeMemoria;
    topeMemoria = topeMemoria->siguiente;

    cout << "Memoria liberada del proceso ID: " << temp->idProceso << ", Tama√±o: " << temp->tamano << " MB\n";
    delete temp;
}

// Ver contenido de la pila de memoria
void verMemoria() {
    if (topeMemoria == NULL) {
        cout << "La pila de memoria est√° vac√≠a.\n";
        return;
    }

    cout << "Contenido de la pila de memoria (LIFO):\n";
    BloqueMemoria* actual = topeMemoria;
    while (actual != NULL) {
        cout << "-----------------------------\n";
        cout << "ID Proceso: " << actual->idProceso << "\n";
        cout << "Tama√±o: " << actual->tamano << " MB\n";
        actual = actual->siguiente;
    }
}


// Insertar proceso al final
void insertarProceso() {
    Proceso* nuevo = new Proceso();
    
    cout << "ID del proceso: ";
    cin >> nuevo->id;
    cin.ignore();

    cout << "Nombre del proceso: ";
    cin.getline(nuevo->nombre, 30);

    cout << "Prioridad (1-5): ";
    cin >> nuevo->prioridad;


    cin.ignore();
    cout << "Estado (nuevo, listo, ejecutando, bloqueado, finalizado): ";
    cin.getline(nuevo->estado, 15);

    nuevo->siguiente = NULL;

    if (inicio == NULL) {
        inicio = nuevo;
    } else {
        Proceso* actual = inicio;
        while (actual->siguiente != NULL) {
            actual = actual->siguiente;
        }
        actual->siguiente = nuevo;
    }

    cout << "Proceso insertado correctamente.\n";
}

// Buscar proceso por ID
void buscarProcesoPorID() {
    int id;
    cout << "Ingrese el ID a buscar: ";
    cin >> id;

    Proceso* actual = inicio;
    while (actual != NULL) {
        if (actual->id == id) {
            cout << "Proceso encontrado:\n";
            cout << "ID: " << actual->id << "\n";
            cout << "Nombre: " << actual->nombre << "\n";
            cout << "Prioridad: " << actual->prioridad << "\n";
            cout << "Estado: " << actual->estado << "\n";
            return;
        }
        actual = actual->siguiente;
    }
    cout << "Proceso no encontrado.\n";
}

// Modificar proceso por ID
void modificarProceso() {
    int id;
    cout << "Ingrese el ID del proceso a modificar: ";
    cin >> id;

    Proceso* actual = inicio;
    while (actual != NULL) {
        if (actual->id == id) {
            cout << "Proceso encontrado. ¬øQu√© desea modificar?\n";
            cout << "1. Prioridad\n2. Estado\nOpci√≥n: ";
            int opcion;
            cin >> opcion;
            cin.ignore();

            if (opcion == 1) {
                cout << "Nueva prioridad (1-5): ";
                cin >> actual->prioridad;
                cout << "Prioridad actualizada.\n";
            } else if (opcion == 2) {
                cout << "Nuevo estado: ";
                cin.ignore();
                cin.getline(actual->estado, 15);
                cout << "Estado actualizado.\n";
            } else {
                cout << "Opci√≥n no v√°lida.\n";
            }
            return;
        }
        actual = actual->siguiente;
    }

    cout << "Proceso no encontrado.\n";
}

// Eliminar proceso por ID
void eliminarProceso() {
    int id;
    cout << "Ingrese el ID del proceso a eliminar: ";
    cin >> id;

    Proceso* actual = inicio;
    Proceso* anterior = NULL;

    while (actual != NULL && actual->id != id) {
        anterior = actual;
        actual = actual->siguiente;
    }

    if (actual == NULL) {
        cout << "Proceso no encontrado.\n";
        return;
    }

    if (anterior == NULL) {
        inicio = actual->siguiente;
    } else {
        anterior->siguiente = actual->siguiente;
    }

    delete actual;
    cout << "Proceso eliminado.\n";
}

// Mostrar todos los procesos
void mostrarProcesos() {
    Proceso* actual = inicio;
    if (actual == NULL) {
        cout << "No hay procesos registrados.\n";
        return;
    }

    cout << "Lista de procesos:\n";
    while (actual != NULL) {
        cout << "-----------------------------\n";
        cout << "ID: " << actual->id << "\n";
        cout << "Nombre: " << actual->nombre << "\n";
        cout << "Prioridad: " << actual->prioridad << "\n";
        cout << "Estado: " << actual->estado << "\n";
        actual = actual->siguiente;
    }
}

//FUNCION PARA ENCOLAR PROCESOS 
void encolarProceso() {
    ProcesoCola* nuevo = new ProcesoCola();
    
    cout << "=== ENCOLAR PROCESO EN COLA DE PRIORIDAD ===\n";
    cout << "ID del proceso: ";
    cin >> nuevo->id;
    cin.ignore();

    cout << "Nombre del proceso: ";
    cin.getline(nuevo->nombre, 30);

    cout << "Prioridad (1=Alta, 2=Media-Alta, 3=Media, 4=Media-Baja, 5=Baja): ";
    cin >> nuevo->prioridad;

    cout << "TamaÒo de memoria (MB): ";
    cin >> nuevo->tamanoMemoria;

    cin.ignore();
    cout << "Estado (nuevo, listo, ejecutando, bloqueado, finalizado): ";
    cin.getline(nuevo->estado, 15);

    nuevo->siguiente = NULL;

    // Insertar en la posiciÛn correcta seg˙n prioridad
    if (inicioCola == NULL || nuevo->prioridad < inicioCola->prioridad) {
        // Insertar al inicio si la cola est· vacÌa o tiene mayor prioridad
        nuevo->siguiente = inicioCola;
        inicioCola = nuevo;
    } else {
        // Buscar la posiciÛn correcta
        ProcesoCola* actual = inicioCola;
        while (actual->siguiente != NULL && actual->siguiente->prioridad <= nuevo->prioridad) {
            actual = actual->siguiente;
        }
        nuevo->siguiente = actual->siguiente;
        actual->siguiente = nuevo;
    }

    cout << "Proceso encolado correctamente seg˙n prioridad.\n";
}

//FUNCION PARA DESENCOLAR PROCESOS 
void desencolarProceso() {
    cout << "=== DESENCOLAR PROCESO DE MAYOR PRIORIDAD ===\n";
    
    if (inicioCola == NULL) {
        cout << "La cola de prioridad est· vacÌa.\n";
        return;
    }

    ProcesoCola* procesoDesencolado = inicioCola;
    inicioCola = inicioCola->siguiente;

    cout << "Proceso desencolado:\n";
    cout << "-----------------------------\n";
    cout << "ID: " << procesoDesencolado->id << "\n";
    cout << "Nombre: " << procesoDesencolado->nombre << "\n";
    cout << "Prioridad: " << procesoDesencolado->prioridad << "\n";
    cout << "TamaÒo Memoria: " << procesoDesencolado->tamanoMemoria << " MB\n";
    cout << "Estado: " << procesoDesencolado->estado << "\n";
    cout << "-----------------------------\n";

    delete procesoDesencolado;
    cout << "Proceso eliminado de la cola de prioridad.\n";
}

//FUNCION PARA MOSTRAR COLA 
void mostrarCola() {
    cout << "=== COLA DE PRIORIDAD ===\n";
    
    if (inicioCola == NULL) {
        cout << "La cola de prioridad est· vacÌa.\n";
        return;
    }

    cout << "Procesos en cola (ordenados por prioridad):\n";
    ProcesoCola* actual = inicioCola;
    int posicion = 1;
    
    while (actual != NULL) {
        cout << "\n--- PosiciÛn " << posicion << " ---\n";
        cout << "ID: " << actual->id << "\n";
        cout << "Nombre: " << actual->nombre << "\n";
        cout << "Prioridad: " << actual->prioridad;
        
        // Mostrar descripciÛn de la prioridad
        switch(actual->prioridad) {
            case 1: cout << " (Alta)"; break;
            case 2: cout << " (Media-Alta)"; break;
            case 3: cout << " (Media)"; break;
            case 4: cout << " (Media-Baja)"; break;
            case 5: cout << " (Baja)"; break;
        }
        
        cout << "\nTamaÒo Memoria: " << actual->tamanoMemoria << " MB\n";
        cout << "Estado: " << actual->estado << "\n";
        
        actual = actual->siguiente;
        posicion++;
    }
}

// Men√∫ principal
int main() {
    int opcion;

    do {
        cout << "\n=== Administrador de Tareas ===\n";
        cout << "1. Insertar proceso\n";
        cout << "2. Buscar proceso por ID\n";
        cout << "3. Modificar proceso\n";
        cout << "4. Eliminar proceso\n";
        cout << "5. Mostrar todos los procesos\n";
        cout << "6. Asignar memoria\n";
        cout << "7. Liberar memoria\n";
        cout << "8. Ver pila de memoria\n";
        cout << "9. Encolar proceso (por prioridad)\n";
        cout << "10. Desencolar proceso (mayor prioridad)\n";
        cout << "11. Mostrar cola de prioridad\n";
        cout << "0. Salir\n";
        cout << "Seleccione una opci√≥n: ";
        cin >> opcion;
        cin.ignore();

        switch (opcion) {
            case 1:
                insertarProceso();
                break;
            case 2:
                buscarProcesoPorID();
                break;
            case 3:
                modificarProceso();
                break;
            case 4:
                eliminarProceso();
                break;
            case 5:
                mostrarProcesos();
                break;
            case 6:
                asignarMemoria();
                break;
            case 7:
                liberarMemoria();
                break;
            case 8:
                verMemoria();
                break;
                
            case 9:
                encolarProceso();
                break;
            case 10:
                desencolarProceso();
                break;
            case 11:
                mostrarCola();
                break;

            case 0:
                cout << "Saliendo del programa.\n";
                break;
            default:
                cout << "Opci√≥n no v√°lida.\n";
        }

    } while (opcion != 0);

    return 0;
}
