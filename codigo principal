#include <iostream>
using namespace std;

struct Proceso {
    int id;
    char nombre[30];
    int prioridad;
    char estado[15];
    Proceso* siguiente;
};

Proceso* inicio = NULL;

// Estructura para el bloque de memoria en la pila
struct BloqueMemoria {
    int idProceso;
    int tamano;
    BloqueMemoria* siguiente;
};

// Puntero al tope de la pila
BloqueMemoria* topeMemoria = NULL;

// Asignar memoria (push)
void asignarMemoria() {
    int id, tamano;
    cout << "ID del proceso que solicita memoria: ";
    cin >> id;
    cout << "Tamaño de memoria a asignar (MB): ";
    cin >> tamano;

    BloqueMemoria* nuevo = new BloqueMemoria();
    nuevo->idProceso = id;
    nuevo->tamano = tamano;
    nuevo->siguiente = topeMemoria;
    topeMemoria = nuevo;

    cout << "Memoria asignada correctamente.\n";
}

// Liberar memoria (pop)
void liberarMemoria() {
    if (topeMemoria == NULL) {
        cout << "No hay memoria para liberar.\n";
        return;
    }

    BloqueMemoria* temp = topeMemoria;
    topeMemoria = topeMemoria->siguiente;

    cout << "Memoria liberada del proceso ID: " << temp->idProceso << ", Tamaño: " << temp->tamano << " MB\n";
    delete temp;
}

// Ver contenido de la pila de memoria
void verMemoria() {
    if (topeMemoria == NULL) {
        cout << "La pila de memoria está vacía.\n";
        return;
    }

    cout << "Contenido de la pila de memoria (LIFO):\n";
    BloqueMemoria* actual = topeMemoria;
    while (actual != NULL) {
        cout << "-----------------------------\n";
        cout << "ID Proceso: " << actual->idProceso << "\n";
        cout << "Tamaño: " << actual->tamano << " MB\n";
        actual = actual->siguiente;
    }
}


// Insertar proceso al final
void insertarProceso() {
    Proceso* nuevo = new Proceso();
    
    cout << "ID del proceso: ";
    cin >> nuevo->id;
    cin.ignore();

    cout << "Nombre del proceso: ";
    cin.getline(nuevo->nombre, 30);

    cout << "Prioridad (1-5): ";
    cin >> nuevo->prioridad;


    cin.ignore();
    cout << "Estado (nuevo, listo, ejecutando, bloqueado, finalizado): ";
    cin.getline(nuevo->estado, 15);

    nuevo->siguiente = NULL;

    if (inicio == NULL) {
        inicio = nuevo;
    } else {
        Proceso* actual = inicio;
        while (actual->siguiente != NULL) {
            actual = actual->siguiente;
        }
        actual->siguiente = nuevo;
    }

    cout << "Proceso insertado correctamente.\n";
}

// Buscar proceso por ID
void buscarProcesoPorID() {
    int id;
    cout << "Ingrese el ID a buscar: ";
    cin >> id;

    Proceso* actual = inicio;
    while (actual != NULL) {
        if (actual->id == id) {
            cout << "Proceso encontrado:\n";
            cout << "ID: " << actual->id << "\n";
            cout << "Nombre: " << actual->nombre << "\n";
            cout << "Prioridad: " << actual->prioridad << "\n";
            cout << "Estado: " << actual->estado << "\n";
            return;
        }
        actual = actual->siguiente;
    }
    cout << "Proceso no encontrado.\n";
}

// Modificar proceso por ID
void modificarProceso() {
    int id;
    cout << "Ingrese el ID del proceso a modificar: ";
    cin >> id;

    Proceso* actual = inicio;
    while (actual != NULL) {
        if (actual->id == id) {
            cout << "Proceso encontrado. ¿Qué desea modificar?\n";
            cout << "1. Prioridad\n2. Estado\nOpción: ";
            int opcion;
            cin >> opcion;
            cin.ignore();

            if (opcion == 1) {
                cout << "Nueva prioridad (1-5): ";
                cin >> actual->prioridad;
                cout << "Prioridad actualizada.\n";
            } else if (opcion == 2) {
                cout << "Nuevo estado: ";
                cin.ignore();
                cin.getline(actual->estado, 15);
                cout << "Estado actualizado.\n";
            } else {
                cout << "Opción no válida.\n";
            }
            return;
        }
        actual = actual->siguiente;
    }

    cout << "Proceso no encontrado.\n";
}

// Eliminar proceso por ID
void eliminarProceso() {
    int id;
    cout << "Ingrese el ID del proceso a eliminar: ";
    cin >> id;

    Proceso* actual = inicio;
    Proceso* anterior = NULL;

    while (actual != NULL && actual->id != id) {
        anterior = actual;
        actual = actual->siguiente;
    }

    if (actual == NULL) {
        cout << "Proceso no encontrado.\n";
        return;
    }

    if (anterior == NULL) {
        inicio = actual->siguiente;
    } else {
        anterior->siguiente = actual->siguiente;
    }

    delete actual;
    cout << "Proceso eliminado.\n";
}

// Mostrar todos los procesos
void mostrarProcesos() {
    Proceso* actual = inicio;
    if (actual == NULL) {
        cout << "No hay procesos registrados.\n";
        return;
    }

    cout << "Lista de procesos:\n";
    while (actual != NULL) {
        cout << "-----------------------------\n";
        cout << "ID: " << actual->id << "\n";
        cout << "Nombre: " << actual->nombre << "\n";
        cout << "Prioridad: " << actual->prioridad << "\n";
        cout << "Estado: " << actual->estado << "\n";
        actual = actual->siguiente;
    }
}

// Menú principal
int main() {
    int opcion;

    do {
        cout << "\n=== Administrador de Tareas ===\n";
        cout << "1. Insertar proceso\n";
        cout << "2. Buscar proceso por ID\n";
        cout << "3. Modificar proceso\n";
        cout << "4. Eliminar proceso\n";
        cout << "5. Mostrar todos los procesos\n";
        cout << "6. Asignar memoria\n";
        cout << "7. Liberar memoria\n";
        cout << "8. Ver pila de memoria\n";
        cout << "0. Salir\n";
        cout << "Seleccione una opción: ";
        cin >> opcion;
        cin.ignore();

        switch (opcion) {
            case 1:
                insertarProceso();
                break;
            case 2:
                buscarProcesoPorID();
                break;
            case 3:
                modificarProceso();
                break;
            case 4:
                eliminarProceso();
                break;
            case 5:
                mostrarProcesos();
                break;
            case 6:
                asignarMemoria();
                break;
            case 7:
                liberarMemoria();
                break;
            case 8:
                verMemoria();
                break;

            case 0:
                cout << "Saliendo del programa.\n";
                break;
            default:
                cout << "Opción no válida.\n";
        }

    } while (opcion != 0);

    return 0;
}
