#include <iostream> 
using namespace std;

// Estructura para cada miembro de la civilización
struct Nodo {
    int id;                  // ID único del miembro
    string nombre;           // Nombre del miembro
    string genero;           // Género del miembro
    int anioNacimiento;      // Año de nacimiento
    Nodo* izquierda;         // Puntero al hijo izquierdo
    Nodo* derecha;           // Puntero al hijo derecho
};

// Función para crear un nuevo nodo
Nodo* crearNodo(int id, string nombre, string genero, int anioNacimiento) {
    Nodo* nuevo = new Nodo;
    nuevo->id = id;
    nuevo->nombre = nombre;
    nuevo->genero = genero;
    nuevo->anioNacimiento = anioNacimiento;
    nuevo->izquierda = NULL;
    nuevo->derecha = NULL;
    return nuevo;
}

// Inserta un nodo en el ABB según el ID
Nodo* insertar(Nodo* raiz, Nodo* nuevo) {
    if (raiz == NULL)
        return nuevo;

    if (nuevo->id < raiz->id)
        raiz->izquierda = insertar(raiz->izquierda, nuevo);
    else if (nuevo->id > raiz->id)
        raiz->derecha = insertar(raiz->derecha, nuevo);
    else
        cout << "ID duplicado. No se puede insertar.\n";

    return raiz;
}

// Buscar un miembro por ID
Nodo* buscarPorID(Nodo* raiz, int id) {
    if (raiz == NULL || raiz->id == id)
        return raiz;

    if (id < raiz->id)
        return buscarPorID(raiz->izquierda, id);
    else
        return buscarPorID(raiz->derecha, id);
}

// Buscar por nombre (recorrido en profundidad)
Nodo* buscarPorNombre(Nodo* raiz, string nombre) {
    if (raiz == NULL)
        return NULL;
    if (raiz->nombre == nombre)
        return raiz;

    Nodo* izq = buscarPorNombre(raiz->izquierda, nombre);
    if (izq != NULL) return izq;

    return buscarPorNombre(raiz->derecha, nombre);
}

// Mostrar ancestros desde la raíz hasta el nodo
bool mostrarAncestros(Nodo* raiz, int id) {
    if (raiz == NULL)
        return false;

    if (raiz->id == id)
        return true;

    if (mostrarAncestros(raiz->izquierda, id) || mostrarAncestros(raiz->derecha, id)) {
        cout << raiz->nombre << " -> ";
        return true;
    }

    return false;
}

// Mostrar descendientes en preorden (nodo, izq, der)
void mostrarDescendientes(Nodo* nodo) {
    if (nodo == NULL) return;

    cout << nodo->nombre << " (" << nodo->id << ")\n";
    mostrarDescendientes(nodo->izquierda);
    mostrarDescendientes(nodo->derecha);
}

// Buscar el nodo mínimo (usado al eliminar nodos con 2 hijos)
Nodo* minimo(Nodo* nodo) {
    while (nodo->izquierda != NULL)
        nodo = nodo->izquierda;
    return nodo;
}

// Eliminar un nodo del ABB
Nodo* eliminar(Nodo* raiz, int id) {
    if (raiz == NULL) return NULL;

    if (id < raiz->id)
        raiz->izquierda = eliminar(raiz->izquierda, id);
    else if (id > raiz->id)
        raiz->derecha = eliminar(raiz->derecha, id);
    else {
        // Nodo con un hijo o sin hijos
        if (raiz->izquierda == NULL) {
            Nodo* temp = raiz->derecha;
            delete raiz;
            return temp;
        }
        else if (raiz->derecha == NULL) {
            Nodo* temp = raiz->izquierda;
            delete raiz;
            return temp;
        }

        // Nodo con dos hijos: se reemplaza por su sucesor
        Nodo* temp = minimo(raiz->derecha);
        raiz->id = temp->id;
        raiz->nombre = temp->nombre;
        raiz->genero = temp->genero;
        raiz->anioNacimiento = temp->anioNacimiento;
        raiz->derecha = eliminar(raiz->derecha, temp->id);
    }
    return raiz;
}

// Recorridos del árbol
void inorden(Nodo* raiz) {
    if (raiz != NULL) {
        inorden(raiz->izquierda);
        cout << raiz->nombre << " (" << raiz->id << ")\n";
        inorden(raiz->derecha);
    }
}

void preorden(Nodo* raiz) {
    if (raiz != NULL) {
        cout << raiz->nombre << " (" << raiz->id << ")\n";
        preorden(raiz->izquierda);
        preorden(raiz->derecha);
    }
}

void postorden(Nodo* raiz) {
    if (raiz != NULL) {
        postorden(raiz->izquierda);
        postorden(raiz->derecha);
        cout << raiz->nombre << " (" << raiz->id << ")\n";
    }
}

// Verifica si un nodo A es ancestro de B
bool esAncestro(Nodo* raiz, int a, int b) {
    Nodo* nodoA = buscarPorID(raiz, a);
    if (nodoA == NULL) return false;

    return buscarPorID(nodoA, b) != NULL;
}

// Verifica si un nodo A es descendiente de B
bool esDescendiente(Nodo* raiz, int a, int b) {
    Nodo* nodoB = buscarPorID(raiz, b);
    if (nodoB == NULL) return false;

    return buscarPorID(nodoB, a) != NULL;
}

